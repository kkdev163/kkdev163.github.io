<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-presentation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Febase 的工程设计与实践 | kkdev163</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kkdev163.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kkdev163.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kkdev163.github.io/presentation/febase"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Febase 的工程设计与实践 | kkdev163"><meta data-rh="true" name="description" content="演讲 PPT: Febase 的工程设计与实践"><meta data-rh="true" property="og:description" content="演讲 PPT: Febase 的工程设计与实践"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-06-09T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://kkdev163.github.io"><meta data-rh="true" property="article:tag" content="web,dev-ops,cicd,febase"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kkdev163.github.io/presentation/febase"><link data-rh="true" rel="alternate" href="https://kkdev163.github.io/presentation/febase" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://kkdev163.github.io/presentation/febase" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="kkdev163 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="kkdev163 Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/presentation/rss.xml" title="kkdev163 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/presentation/atom.xml" title="kkdev163 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.5f14fa28.css">
<link rel="preload" href="/assets/js/runtime~main.69c15619.js" as="script">
<link rel="preload" href="/assets/js/main.8e1951b7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">kkdev163</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">文章</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/presentation">演讲</a><a class="navbar__item navbar__link" href="/resume">关于我</a><a href="https://github.com/kkdev163" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">最近演讲</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/presentation/febase">Febase 的工程设计与实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/presentation/wechaty">微信聊天机器人</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/presentation/gmtc-web-monitor">GMTC 2021 参会分享之-前端质量保障专题</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/presentation/web-vitals">谷歌体验度量指标集 Web Vitals</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/presentation/web-apm">云音乐前端性能监控平台</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/presentation/performance-basic">页面渲染性能优化基础</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="演讲 PPT: Febase 的工程设计与实践"><header><h1 class="title_f1Hy" itemprop="headline">Febase 的工程设计与实践</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-06-09T00:00:00.000Z" itemprop="datePublished">2022年6月9日</time> · <!-- -->阅读需 14 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://kkdev163.github.io" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/34838245?v=4" alt="kkdev163" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://kkdev163.github.io" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">kkdev163</span></a></div><small class="avatar__subtitle" itemprop="description">Web 全栈开发工程师@NetEase</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>演讲 PPT: <a href="https://docs.google.com/presentation/d/1T64cQOkNFf6Ti-NZmKmY4kTTk9oSAmduNGlwnx1bkJk/edit#slide=id.g24aa805472e_1_70" target="_blank" rel="noopener noreferrer">Febase 的工程设计与实践</a></p><p>演讲场所: 网易-组内分享</p><p>演讲简介: 本次演讲介绍网易云音乐一站式研发平台 Febase 的工程设计与实现。</p><p>演讲时间: 2022-06-09</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_S0QG"><p>以下为演讲逐字稿</p></div></div><h1>演讲逐字稿</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="0-开场词">0. 开场词<a href="#0-开场词" class="hash-link" aria-label="0. 开场词的直接链接" title="0. 开场词的直接链接">​</a></h2><p>大家好，我是 kkdev163，今天为大家带来的分享主题是《Febase 的工程设计与实现》。</p><p>大家在日常的开发过程中，或多或少都有使用过 Febase。那你是否对平台的技术实现有过好奇呢？</p><p>这次分享，我就为大家揭开 Febase 背后的技术实现，是怎样一个技术架构，驱动了 Febase 平台的 持续迭代 和 扩展。希望能为大家带来一些 启发、思考。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-大纲">1. 大纲<a href="#1-大纲" class="hash-link" aria-label="1. 大纲的直接链接" title="1. 大纲的直接链接">​</a></h2><p>本次分享会分为 5 个部分..</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一引言-febase-产品简介">一.引言 (Febase 产品简介)<a href="#一引言-febase-产品简介" class="hash-link" aria-label="一.引言 (Febase 产品简介)的直接链接" title="一.引言 (Febase 产品简介)的直接链接">​</a></h2><ul><li>Febase 是一站式的研发平台，覆盖了从工程初始化到线上监控的研发生命周期。</li><li>上线部署阶段，Febase 提供了一致性的部署体验，如今在一个平台，我们就可以完成 多应用类型的发布</li><li>Febase 还提供了上线流程管控，帮助研发团队养成规范的代码上线流程。</li><li>Febase 还通过 OpenApi 的方式，向第三方平台暴露 应用模型 与 全部底层能力。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二febase-的多应用类型部署">二.Febase 的多应用类型部署<a href="#二febase-的多应用类型部署" class="hash-link" aria-label="二.Febase 的多应用类型部署的直接链接" title="二.Febase 的多应用类型部署的直接链接">​</a></h2><blockquote><p>由简化到复杂，抽象到具体，从一种 应用类型 到 多种应用类型 的部署</p></blockquote><p>Febase 作为一个研发平台，最核心的功能点是 部署。我们首先来思考下，当我们设计一个部署平台时，最小可行产品(MVP) 是什么？</p><p>我的理解是: 这个产品可以将远程仓库代码 clone 下来，构建出线上产物，最后提供出该产物的可访问链接。</p><p>当从一个 MVP 扩展到一个 生产环境 可用的服务时，整体架构会有哪些不同？</p><p>我以静态部署平台 SDP 为例，展开介绍下:</p><ul><li>SDP 需要提供一个可视化的部署平台，方便开发者配置应用部署的元信息</li><li>如 应用名、Git 仓库、访问路由等</li><li>在开发者触发构建时，管理后台会调用 构建服务，触发构建流水线</li><li>在构建完成后，通知 产物托管服务 下载产物，并存储在 磁盘中。</li><li>在产物托管完成后，管理后台会通知网关 更新路由信息。</li><li>之后用户就可以通过 公网链接，请求到 网关</li><li>最后由 网关 解析路由，读取静态资源</li></ul><p>虽然最小可行产品 MVP 很简洁，但我们看到 静态部署平台 需要分别起了 4 个服务，将静态资源托管这件事做到极致。这套架构支撑起了 云音乐庞大的 静态 Web 业务 和 RN 业务。</p><p>在 Febase 中，我们并没有重复造一套轮子，而是通过将 SDP 的部署能力下沉，提供出静态部署的原子能力。类似的 Alpaca 平台，提供了容器部署原子能力。这些部署能力，成为了我们打造 Febase 多应用类型部署的基础。</p><p>在接入 SDP、Alpaca，甚至未来更多的部署能力时，我们是如何确保整体架构的 可维护性 与 可扩展性的呢？</p><p>首先我们为部署能力，定义了一个统一的适配器抽象， 称其为 DeployProvider。在其上定义了公共的抽象方法。</p><p>在对接具体的应用类型时，适配器需要实现这个接口, 如静态 Web 类型，在实现时，会调用 sdpRpc 方法实现具体发布逻辑。 容器类型，在实现时，会调用 alpacaRpc 方法实现具体的发布逻辑。</p><p>有了这一层抽象和实现后，我们就可以为不同的应用类型部署，提供统一的 Service 和 Controller 接口。在接口内部，我们根据应用类型，选择对应的适配器做发布。</p><p>我再通过一个示意图来复述下:</p><ul><li>在 Node 服务层的后端，抽象出了 DeployProvider 接口</li><li>针对不同的应用类型，实现适配器</li><li>对前端我们可以暴露，统一的部署方法。</li><li>通过这个方式，我们解决了不同应用类型的 部署能力实现差异的问题。</li><li>并且在未来，新增部署类型时，我们只需以插件的方式新增一个 xProvider，就可以引入该部署能力。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三-febase-的流程管控设计">三. Febase 的流程管控设计<a href="#三-febase-的流程管控设计" class="hash-link" aria-label="三. Febase 的流程管控设计的直接链接" title="三. Febase 的流程管控设计的直接链接">​</a></h2><ul><li>在 Febase 中，我们希望能规范应用的上线步骤，规避多人开发场景下的分支冲突。</li><li>同时我们也需要为不同应用类型，提供上线步骤的定制能力。</li></ul><p>为此我们在 Febase 中引入了 发布流程 的概念。</p><p>一个发布分支，需要走完 「开发」、「卡点」、「上线」等阶段的验证才能被合并入主干。</p><p>在引入发布流程时，我们首先要解决的是流程如何管理的问题:</p><ol><li>每个流程需要以一定的方式定义，并被计算机程序读取。</li><li>流程当前所处的节点，需要被持久化存储。</li><li>流程可以以 串行、并行 的方式 向前推进、也可以回退到前置的节点。</li></ol><p>为了完成上述对流程的管理，最朴素的方式是，我们可以选择在业务代码中，手动处理流程状态，但是随着 业务复杂度 的提升，流程状态的管理 与 业务逻辑 相耦合，将会使得项目变得难以维护 和 扩展。</p><p>为了简化对流程的管理。业界沉淀了一套流程状态管理工具称为「流程引擎」。这套工具就好像前端的视图层框架，我们只需要专注于业务逻辑的编写，DOM 的操作更新就交由框架来处理。大大降低前端开发的复杂度，提升项目的可维护性。</p><p>在计划引入「流程引擎」时，我们调研了市面上==的开源产==品，最终选择了自研「流程引擎」，我们的「流程引擎」除了满足常规的流程状态管理外，还有以下几点特色:</p><ol><li>JS 生态，对前端开发者友好。</li><li>提供前端套件，流程状态管理可驱动前端视图变更。</li><li>覆盖常见的编排需求，整体复杂度可控，最适合 Febase。</li></ol><p>我们来看下自研的「流程引擎」 在 Febase 中的具体使用吧。</p><p>在 packages/server/app/workflow/definition 目录中，会定义不同应用类型的流程</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">└── definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── caas-0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── graphql-0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── graphql-0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── node-0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── node-0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── react-native-0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── react-native-0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── web-0.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── index.ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── web-0.0.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── index.ts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>打开 web-0.0.2/index.ts</p><p>endpoint 指明在流程推进到该节点时需要执行的函数。我们可以在该函数中执行该节点初始化对应的业务逻辑 并根据业务逻辑执行结果 返回相应的 节点流程状态。</p><p>以 review 节点为例，在节点初始化时...</p><p>我们再来看 complete 节点...</p><p>不同应用类型的流程编排和相应的业务处理逻辑，我们是在后端中定义。我们再来看下前端视图部分的映射。</p><p>packages/web/src/workflow/definition 中定义不同应用类型的流程视图映射</p><p>引擎会为绑定的 Overview 组件 和 节点组件 传入流程状态信息，供渲染使用，并为组件暴露触发流程状态变更的 dispatch 函数，供前端视图层调用。</p><p>通过声明式的代码，我们将 流程编排好了 并对视图做了绑定。
在发布详情页，我们只需使用 useWorkflow 方法传入 流程 ID，引擎就会为我们提供出对应的流程组件，并在流程状态变化时，驱动对应节点视图的渲染。</p><p>通过自研的流程引擎，我们将 流程状态管理 与 具体的业务逻辑 解耦，并通过 流程引擎 驱动前端视图的变更，以此降低了业务逻辑开发的复杂度，且在未来引入新应用类型时具有良好的扩展性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四-openapi-网关的设计">四. OpenAPI 网关的设计<a href="#四-openapi-网关的设计" class="hash-link" aria-label="四. OpenAPI 网关的设计的直接链接" title="四. OpenAPI 网关的设计的直接链接">​</a></h2><p>Febase 的后端，不仅需要面向 Febase 管理后台前端提供接口。
同时还要向 第三方平台，如 Overmind、低代码平台 还有 CLI 工具，如 Mug 等提供开放接口。
过去我们搭建公技产品时的做法是，面向管理后台前端使用 Cookie 登录认证。
对第三方平台，使用特殊请求头。
通过白名单的方式，来指定开放接口
然后在每个业务逻辑实现中，根据 请求来源，单独地做 权限校验。
过去这种 职责不单一、面向过程式的鉴权方式，将会导致 难以维护 和 扩展，无法承载 Febase 开放平台的全部底层能力的目标。</p><p>我们的做法是抽取出了 单独的 OpenAPI 网关层。</p><p>在后端的接口中，用声明式的方式，描述接口所需的 最低权限。
在应用启动时，会收集全部的路由+权限声明，并存入数据库中。
并将 路由与权限信息注册至网关。
由于路由与权限信息都做了入库，所以也可以在管理后台中，对接口的权限做配置管理。
对于多消费场景，统一使用 Febase 派发的 用户 Token 进行认证和鉴权。
只有满足权限要求的请求，才会打到 Febase 后端。
这么做的好处是</p><ul><li>声明式的鉴权配置</li><li>多消费场景的统一认证机制</li><li>与 业务逻辑层的职责单一</li></ul><p>以此达到架构的可扩展和易维护。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="介绍完多个模块的设计实现后我们再来看下-febase-的主体架构">介绍完多个模块的设计实现后，我们再来看下 Febase 的主体架构<a href="#介绍完多个模块的设计实现后我们再来看下-febase-的主体架构" class="hash-link" aria-label="介绍完多个模块的设计实现后，我们再来看下 Febase 的主体架构的直接链接" title="介绍完多个模块的设计实现后，我们再来看下 Febase 的主体架构的直接链接">​</a></h3><p>介绍完主体的架构后，我们介绍下 Febase 引入 GraphQL 应用类型的步骤。</p><p>由于可扩展性的架构设计，Febase 工程引入 GraphQL 部署流程，就像增加一个新插件一样，不会污染已有应用的业务逻辑，也不会增加整体工程的复杂度，使得整体架构保持良好的可维护性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四未来展望">四.未来展望<a href="#四未来展望" class="hash-link" aria-label="四.未来展望的直接链接" title="四.未来展望的直接链接">​</a></h2><blockquote><p>介绍未来将 Febase 向集团内推广，我们需要做哪些努力？ 如底层部署的 租户隔离 、 域名定制 等</p></blockquote><blockquote><p>自动创建 曙光 埋点应用</p></blockquote></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/presentation/tags/web">web</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/presentation/tags/dev-ops">dev-ops</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/presentation/tags/cicd">cicd</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/presentation/tags/febase">febase</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--next" href="/presentation/wechaty"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">微信聊天机器人</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#0-开场词" class="table-of-contents__link toc-highlight">0. 开场词</a></li><li><a href="#1-大纲" class="table-of-contents__link toc-highlight">1. 大纲</a></li><li><a href="#一引言-febase-产品简介" class="table-of-contents__link toc-highlight">一.引言 (Febase 产品简介)</a></li><li><a href="#二febase-的多应用类型部署" class="table-of-contents__link toc-highlight">二.Febase 的多应用类型部署</a></li><li><a href="#三-febase-的流程管控设计" class="table-of-contents__link toc-highlight">三. Febase 的流程管控设计</a></li><li><a href="#四-openapi-网关的设计" class="table-of-contents__link toc-highlight">四. OpenAPI 网关的设计</a><ul><li><a href="#介绍完多个模块的设计实现后我们再来看下-febase-的主体架构" class="table-of-contents__link toc-highlight">介绍完多个模块的设计实现后，我们再来看下 Febase 的主体架构</a></li></ul></li><li><a href="#四未来展望" class="table-of-contents__link toc-highlight">四.未来展望</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 kkdev163. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.69c15619.js"></script>
<script src="/assets/js/main.8e1951b7.js"></script>
</body>
</html>