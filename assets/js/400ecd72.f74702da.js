"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1767],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>b});var l=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,l)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function u(e,t){if(null==e)return{};var a,l,n=function(e,t){if(null==e)return{};var a,l,n={},r=Object.keys(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(l=0;l<r.length;l++)a=r[l],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=l.createContext({}),o=function(e){var t=l.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},s=function(e){var t=o(e.components);return l.createElement(p.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},k=l.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,p=e.parentName,s=u(e,["components","mdxType","originalType","parentName"]),m=o(a),k=n,b=m["".concat(p,".").concat(k)]||m[k]||d[k]||r;return a?l.createElement(b,i(i({ref:t},s),{},{components:a})):l.createElement(b,i({ref:t},s))}));function b(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,i=new Array(r);i[0]=k;var u={};for(var p in t)hasOwnProperty.call(t,p)&&(u[p]=t[p]);u.originalType=e,u[m]="string"==typeof e?e:n,i[1]=u;for(var o=2;o<r;o++)i[o]=a[o];return l.createElement.apply(null,i)}return l.createElement.apply(null,a)}k.displayName="MDXCreateElement"},4612:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>u,toc:()=>o});var l=a(7462),n=(a(7294),a(3905));const r={slug:"wapm-storage",title:"\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5e73\u53f0-\u5b58\u50a8\u4e0e\u8ba1\u7b97\u67b6\u6784\u5c55\u671b",authors:["kkdev163"],tags:["influxdb","performance","web"]},i=void 0,u={permalink:"/blog/wapm-storage",source:"@site/blog/2019-03-29-wapm-storage/index.md",title:"\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5e73\u53f0-\u5b58\u50a8\u4e0e\u8ba1\u7b97\u67b6\u6784\u5c55\u671b",description:"\u524d\u8a00",date:"2019-03-29T00:00:00.000Z",formattedDate:"2019\u5e743\u670829\u65e5",tags:[{label:"influxdb",permalink:"/blog/tags/influxdb"},{label:"performance",permalink:"/blog/tags/performance"},{label:"web",permalink:"/blog/tags/web"}],readingTime:11.745,hasTruncateMarker:!0,authors:[{name:"kkdev163",title:"Web \u5168\u6808\u5f00\u53d1\u5de5\u7a0b\u5e08@NetEase",url:"https://kkdev163.github.io",imageURL:"https://avatars.githubusercontent.com/u/34838245?v=4",key:"kkdev163"}],frontMatter:{slug:"wapm-storage",title:"\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5e73\u53f0-\u5b58\u50a8\u4e0e\u8ba1\u7b97\u67b6\u6784\u5c55\u671b",authors:["kkdev163"],tags:["influxdb","performance","web"]},prevItem:{title:"Lighthous \u6d4b\u8bd5\u5185\u5e55",permalink:"/blog/lighthouse"},nextItem:{title:"Sentry\u5e73\u53f0-\u4e3aDocker Swarm\u96c6\u7fa4\u6dfb\u52a0SSHFS\u5206\u5e03\u5f0f\u6587\u4ef6\u5b58\u50a8",permalink:"/blog/sentry-sshfs"}},p={authorsImageUrls:[void 0]},o=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:3},{value:"\u5f53\u524d\u67b6\u6784",id:"\u5f53\u524d\u67b6\u6784",level:3},{value:"Influx Proxy \u7684\u96c6\u7fa4\u7684\u4f18\u52bf",id:"influx-proxy-\u7684\u96c6\u7fa4\u7684\u4f18\u52bf",level:4},{value:"1.\u6309 measurement(\u6570\u636e\u5e93\u8868\u540d)\u505a\u5206\u7247\u3002",id:"1\u6309-measurement\u6570\u636e\u5e93\u8868\u540d\u505a\u5206\u7247",level:5},{value:"2. \u6570\u636e\u5907\u4efd\u80fd\u529b\u3002",id:"2-\u6570\u636e\u5907\u4efd\u80fd\u529b",level:5},{value:"3. \u5199\u5931\u8d25\u65f6\uff0c\u7f13\u5b58\u91cd\u8bd5\u80fd\u529b\u3002",id:"3-\u5199\u5931\u8d25\u65f6\u7f13\u5b58\u91cd\u8bd5\u80fd\u529b",level:5},{value:"4. \u9ad8\u5371\u67e5\u8be2\u8bed\u53e5\u8fc7\u6ee4\u80fd\u529b\u3002",id:"4-\u9ad8\u5371\u67e5\u8be2\u8bed\u53e5\u8fc7\u6ee4\u80fd\u529b",level:5},{value:"\u5f53\u524d\u67b6\u6784\u5b58\u5728\u7684\u75db\u70b9",id:"\u5f53\u524d\u67b6\u6784\u5b58\u5728\u7684\u75db\u70b9",level:4},{value:"1. Proxy \u8282\u70b9\u5f53\u524d\u65e0\u9ad8\u53ef\u7528",id:"1-proxy-\u8282\u70b9\u5f53\u524d\u65e0\u9ad8\u53ef\u7528",level:5},{value:"2. Proxy \u662f\u5bf9\u8bfb\u5199\u8bf7\u6c42\u505a\u4e86\u4e00\u5c42\u4ee3\u7406\uff0c\u975e master slave \u96c6\u7fa4\u6a21\u5f0f",id:"2-proxy-\u662f\u5bf9\u8bfb\u5199\u8bf7\u6c42\u505a\u4e86\u4e00\u5c42\u4ee3\u7406\u975e-master-slave-\u96c6\u7fa4\u6a21\u5f0f",level:5},{value:"3. \u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u6210\u672c\u9ad8",id:"3-\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u6210\u672c\u9ad8",level:5},{value:"4. \u4ec5\u652f\u6301 measurement \u5c42\u9762\u7684\u5206\u7247, \u65e0\u6cd5\u6309\u6570\u636e\u5206\u7247",id:"4-\u4ec5\u652f\u6301-measurement-\u5c42\u9762\u7684\u5206\u7247-\u65e0\u6cd5\u6309\u6570\u636e\u5206\u7247",level:5},{value:"NTSDB",id:"ntsdb",level:3},{value:"Influx \u5b58\u50a8\u6a21\u578b\u7b80\u4ecb",id:"influx-\u5b58\u50a8\u6a21\u578b\u7b80\u4ecb",level:4},{value:"\u6807\u51c6\u67b6\u6784",id:"\u6807\u51c6\u67b6\u6784",level:3},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:3}],s={toc:o},m="wrapper";function d(e){let{components:t,...a}=e;return(0,n.kt)(m,(0,l.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h3",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,n.kt)("p",null,"\u672c\u6587\u9996\u5148\u4ecb\u7ecd\u7f51\u6613\u4e91\u97f3\u4e50\u81ea\u7814\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5e73\u53f0\u7684\u67b6\u6784\u73b0\u72b6\u548c\u5f53\u524d\u9047\u5230\u7684\u95ee\u9898\u3002\u968f\u540e\u4ecb\u7ecd\u4e86 NTSDB \u5b58\u50a8\u5f15\u64ce\u53ef\u4ee5\u89e3\u51b3\u7684\u95ee\u9898\uff0c\u5e76\u8fdb\u4e00\u6b65\u7ed9\u51fa\u66f4\u7b26\u5408\u4e1a\u754c\u6807\u51c6\u7684\u76d1\u63a7\u5e73\u53f0\u5b58\u50a8\u4e0e\u8ba1\u7b97\u67b6\u6784\u3002\u6587\u4e2d NTSDB \u4e0e\u4e1a\u754c\u901a\u7528\u67b6\u6784\u4e3b\u8981\u662f\u6839\u636e\u7f51\u6613\u6570\u636e\u79d1\u5b66\u4e2d\u5fc3\u65f6\u5e8f\u6570\u636e\u5e93\u9886\u57df\u4e13\u5bb6-",(0,n.kt)("a",{href:"http://hbasefly.com/author/libisthanksgmail-com/",target:"_blank"},"\u8303\u6b23\u6b23"),"\u7ed9\u51fa\u7684\u5efa\u8bae\u6574\u7406\u800c\u6765\u3002"),(0,n.kt)("h3",{id:"\u5f53\u524d\u67b6\u6784"},"\u5f53\u524d\u67b6\u6784"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/tBao5AUpLEFlGenlxk4y0A==/109951163959092198.png",alt:"image"}),"\n\u6d4f\u89c8\u5668\u7aef SDK \u91c7\u96c6\u7684\u6027\u80fd\u6570\u636e\u4f1a\u7ecf\u8fc7 Nginx \u8d1f\u8f7d\u5747\u8861\u5230 NodeJS \u670d\u52a1\u5668, NodeJS \u670d\u52a1\u5668\u5bf9\u4e0a\u62a5\u6570\u636e\u505a\u5408\u6cd5\u6821\u9a8c\u540e, \u76f4\u63a5\u5c06\u539f\u59cb\u6570\u636e\u8f6c\u53d1\u81f3 InfluxProxy,InfluxProxy \u6839\u636e\u914d\u7f6e\u5c06\u6570\u636e\u6309\u8868\u5206\u7247\u81f3\u5e95\u5c42\u7684 InfluxDB \u8282\u70b9\u3002"),(0,n.kt)("h4",{id:"influx-proxy-\u7684\u96c6\u7fa4\u7684\u4f18\u52bf"},"Influx Proxy \u7684\u96c6\u7fa4\u7684\u4f18\u52bf"),(0,n.kt)("p",null,"\u5f53\u524d\u6211\u4eec\u7684\u5b58\u50a8\u4e0e\u8ba1\u7b97\u67b6\u6784\u7684\u5b9e\u73b0\u4e3b\u8981\u662f\u4f9d\u8d56\u4e8e InfluxProxy\u3001InfluxDB \u6240\u6784\u6210\u7684\u8ba1\u7b97\u5b58\u50a8\u96c6\u7fa4\u3002InfluxProxy \u4e3a\u997f\u4e86\u4e48\u5f00\u6e90\u7684",(0,n.kt)("a",{parentName:"p",href:"https://github.com/shell909090/influx-proxy"},"\u7ec4\u4ef6"),",\u4e3b\u8981\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u7684\u529f\u80fd\uff1a"),(0,n.kt)("h5",{id:"1\u6309-measurement\u6570\u636e\u5e93\u8868\u540d\u505a\u5206\u7247"},"1.\u6309 measurement(\u6570\u636e\u5e93\u8868\u540d)\u505a\u5206\u7247\u3002"),(0,n.kt)("p",null,"Proxy \u8282\u70b9\u4e2d\u4f1a\u7ef4\u62a4 DB \u8282\u70b9\u4e0e measurement \u7684\u6620\u5c04\u5173\u7cfb,\u6839\u636e\u8be5\u914d\u7f6e\uff0c\u53ef\u5c06\u540c\u4e00\u4e2a\u6570\u636e\u5e93\u7684\u8868\u5b58\u5165\u4e0d\u540c\u7684 DB \u8282\u70b9, \u4ee5\u8fbe\u5230\u6a2a\u5411\u6269\u5c55\u7684\u76ee\u7684\u3002\u914d\u7f6e\u793a\u610f\u5982\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"    {\n        db1: ['table1'],\n        db2: ['table2'],\n        db3: ['table3'],\n        ...\n    }\n")),(0,n.kt)("h5",{id:"2-\u6570\u636e\u5907\u4efd\u80fd\u529b"},"2. \u6570\u636e\u5907\u4efd\u80fd\u529b\u3002"),(0,n.kt)("p",null,"InfluxDB \u63d0\u4f9b replication \u53c2\u6570\u8bbe\u7f6e\u526f\u672c\u6570\uff0c\u4f46\u5355\u673a\u7248\u7684\u526f\u672c\u5728\u540c\u4e00\u4e3b\u673a\u4e0a\uff0c\u65e0\u6cd5\u505a\u5230\u9ad8\u53ef\u7528\u3002\u82e5\u5728 proxy \u4e0a\u5c06\u540c\u4e00\u5f20\u8868\u914d\u7f6e\u5728\u591a\u4e2a DB \u8282\u70b9\uff0c\u5728\u6570\u636e\u5b58\u5165\u65f6\uff0cProxy \u4f1a\u5c06\u6570\u636e\u5199\u5165\u591a\u4e2a DB \u8282\u70b9\uff0c\u8fbe\u5230\u6570\u636e\u5907\u4efd\u7684\u76ee\u7684\uff0c\u5728\u8bfb\u53d6\u65f6 Proxy \u4f1a\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a DB \u8282\u70b9\u53d6\u51fa\u6570\u636e\uff0c\u4ee5\u5b9e\u73b0 influxDB \u8282\u70b9\u7684\u9ad8\u53ef\u7528\u5e76\u63d0\u9ad8\u8bfb\u53d6\u6027\u80fd\u3002\u914d\u7f6e\u793a\u610f\u5982\u4e0b\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"    {\n        db1: ['table1', 'table2', 'table3'],\n        db2: ['table1', 'table2', 'table3']\n    }\n")),(0,n.kt)("h5",{id:"3-\u5199\u5931\u8d25\u65f6\u7f13\u5b58\u91cd\u8bd5\u80fd\u529b"},"3. \u5199\u5931\u8d25\u65f6\uff0c\u7f13\u5b58\u91cd\u8bd5\u80fd\u529b\u3002"),(0,n.kt)("p",null,"\u5f53\u5e95\u5c42\u7684 DB \u8282\u70b9\u6302\u6389\u65f6\uff0cProxy \u8282\u70b9\u4f1a\u5c06\u6570\u636e\u5148\u5199\u5165\u672c\u5730\u6587\u4ef6\u4e2d\uff0c\u5f85 DB \u8282\u70b9\u6062\u590d\u540e\uff0cProxy \u8282\u70b9\u4f1a\u5c06\u6570\u636e\u91cd\u65b0\u5199\u5165 DB \u8282\u70b9\u3002"),(0,n.kt)("h5",{id:"4-\u9ad8\u5371\u67e5\u8be2\u8bed\u53e5\u8fc7\u6ee4\u80fd\u529b"},"4. \u9ad8\u5371\u67e5\u8be2\u8bed\u53e5\u8fc7\u6ee4\u80fd\u529b\u3002"),(0,n.kt)("p",null,"\u82e5\u67e5\u8be2\u8bed\u53e5\u4e2d\u4e0d\u901a\u8fc7 where duration \u6307\u5b9a\u67e5\u8be2\u8303\u56f4, influx \u4f1a\u5c06\u7b26\u5408\u8be5\u67e5\u8be2\u7684\u5168\u90e8\u7d22\u5f15\u52a0\u8f7d\u81f3\u5185\u5b58\u4e2d\uff0c\u4f1a\u4ea7\u751f\u6781\u5927\u7684\u6027\u80fd\u5f00\u9500\u3002Proxy \u4f1a\u8fc7\u6ee4\u7c7b\u4f3c\u7684\u9ad8\u5371\u67e5\u8be2\u8bed\u53e5\u3002"),(0,n.kt)("h4",{id:"\u5f53\u524d\u67b6\u6784\u5b58\u5728\u7684\u75db\u70b9"},"\u5f53\u524d\u67b6\u6784\u5b58\u5728\u7684\u75db\u70b9"),(0,n.kt)("h5",{id:"1-proxy-\u8282\u70b9\u5f53\u524d\u65e0\u9ad8\u53ef\u7528"},"1. Proxy \u8282\u70b9\u5f53\u524d\u65e0\u9ad8\u53ef\u7528"),(0,n.kt)("p",null,"Proxy \u8282\u70b9\u4e3a\u6574\u4e2a\u5b58\u50a8\u4e0e\u8ba1\u7b97\u7684\u5165\u53e3, \u82e5 Proxy \u8282\u70b9\u6302\u6389\uff0c\u6027\u80fd\u76d1\u63a7\u7684\u5168\u90e8\u5b58\u50a8\u4e0e\u8ba1\u7b97\u670d\u52a1\u5c31\u6302\u6389\u4e86\u3002\u5f53\u7136\u8fd9\u4e2a\u95ee\u9898\u5e76\u975e\u7279\u522b\u68d8\u624b\uff0c\u540e\u7eed\u53ef\u4ee5\u901a\u8fc7\u642d\u5efa\u591a\u53f0 Proxy, \u7531 NodeJS \u7aef\u505a\u8d1f\u8f7d\u5747\u8861\u6765\u89e3\u51b3\u8be5\u95ee\u9898\u3002"),(0,n.kt)("h5",{id:"2-proxy-\u662f\u5bf9\u8bfb\u5199\u8bf7\u6c42\u505a\u4e86\u4e00\u5c42\u4ee3\u7406\u975e-master-slave-\u96c6\u7fa4\u6a21\u5f0f"},"2. Proxy \u662f\u5bf9\u8bfb\u5199\u8bf7\u6c42\u505a\u4e86\u4e00\u5c42\u4ee3\u7406\uff0c\u975e master slave \u96c6\u7fa4\u6a21\u5f0f"),(0,n.kt)("p",null,"\bProxy \u8282\u70b9\u7ef4\u62a4\u4e86\u8868\u4e0e DB \u5b9e\u4f8b\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u505a\u4e86\u4e00\u5c42\u6570\u636e\u8bfb\u5199\u7684\u4ee3\u7406\u3002\u4f46\u50cf\u521b\u5efa Petention Policy(\u6570\u636e\u4fdd\u7559\u8fc7\u671f\u7b56\u7565)\u3001\u521b\u5efa Continue Query(\u6301\u7eed\u67e5\u8be2)\u7b49\u65e0\u6cd5\u505a\u4ee3\u7406\u548c\u540c\u6b65\uff0c\u9700\u8981\u624b\u52a8\u8fde\u63a5\u81f3 DB \u8282\u70b9\u8fdb\u884c\u7ba1\u7406\u3002\u8fd9\u6837\u4f1a\u5b58\u5728\u4ec0\u4e48\u95ee\u9898\u5462\uff1f"),(0,n.kt)("p",null,"\u5f53\u53ea\u6709\u4e00\u4e24\u4e2a DB \u8282\u70b9\u65f6, \u8fd9\u6837\u624b\u52a8\u7ba1\u7406\u5e76\u6ca1\u6709\u592a\u5927\u95ee\u9898\u3002\u4f46\u662f\u5f53 DB \u5b9e\u4f8b\u4e2a\u6570\u7ee7\u7eed\u6269\u5927\u540e, \u624b\u52a8\u7ba1\u7406\u5206\u7247 A \u5b9e\u4f8b\u3001\u5206\u7247 B \u5b9e\u4f8b\u3001\u5206\u7247 A \u526f\u672c\u5b9e\u4f8b\u3001\u5206\u7247 B \u526f\u672c\u5b9e\u4f8b, \u82e5\u540e\u7eed\u8fd8\u6709\u6570\u636e\u8fc1\u79fb\uff0c\u5219 CQ \u914d\u7f6e\u7684\u7ba1\u7406\u5c06\u662f\u4e00\u4e2a\u5669\u68a6\u3002"),(0,n.kt)("h5",{id:"3-\u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u6210\u672c\u9ad8"},"3. \u6269\u5bb9\u548c\u6570\u636e\u8fc1\u79fb\u6210\u672c\u9ad8"),(0,n.kt)("p",null,"\u7531\u4e8e Proxy \u662f\u6309\u7167\u8868\u8fdb\u884c\u6570\u636e\u7684\u5206\u7247, \u5047\u8bbe\u4e00\u5f00\u59cb\u53ea\u7528\u5230\u4e86 Proxy \u63d0\u4f9b\u7684\u6570\u636e\u5907\u4efd\u80fd\u529b\u5373\u6309\u4ee5\u4e0b\u8fdb\u884c\u914d\u7f6e\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"    {\n        db1: ['table1', 'table2', 'table3', 'table4'],\n        db2: ['table1', 'table2', 'table3', 'table4']\n    }\n")),(0,n.kt)("p",null,"\u5f53\u63a5\u5165\u7684\u5e94\u7528\u6570\u9010\u6b65\u589e\u52a0\u540e, \u4e00\u53f0 db \u65e0\u6cd5\u627f\u8f7d 3 \u5f20\u8868\u7684\u5b58\u50a8\u4e0e\u8ba1\u7b97\u5f00\u9500\u3002\u6211\u4eec\u505a\u6269\u5bb9\u7684\u5de5\u4f5c,\u6bd4\u5982\u65b0\u7533\u8bf7 2 \u53f0\u673a\u5668\uff0c\u628a table3\u3001table4 \u62c6\u5206\u5230\u65b0\u7684\u673a\u5668\u4e0a\u3002"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"    {\n        db1: ['table1', 'table2'],\n        db2: ['table1', 'table2'],\n        db3: ['table3', 'table4'],\n        db4: ['table3', 'table4'],\n    }\n")),(0,n.kt)("p",null,"\u9664\u4e86\u4fee\u6539 Proxy \u7684\u914d\u7f6e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u5c06\u539f\u672c db1 db2 \u4e0a\u7684\u6570\u636e\u8fc1\u79fb\u5230 db3\u3001db4 \u4e0a\u3002\u5e76\u4e14\u628a\u539f\u672c\u9488\u5bf9 table3\u3001table4 \u7684 CQ \u914d\u7f6e\u4e5f\u8fc1\u79fb\u5230 db3\u3001db4\u3002"),(0,n.kt)("h5",{id:"4-\u4ec5\u652f\u6301-measurement-\u5c42\u9762\u7684\u5206\u7247-\u65e0\u6cd5\u6309\u6570\u636e\u5206\u7247"},"4. \u4ec5\u652f\u6301 measurement \u5c42\u9762\u7684\u5206\u7247, \u65e0\u6cd5\u6309\u6570\u636e\u5206\u7247"),(0,n.kt)("p",null,"\u5047\u8bbe\u968f\u7740\u5e94\u7528\u7684\u589e\u591a\uff0c\u6211\u4eec\u5df2\u7ecf\u5fcd\u7740\u5267\u75db\uff0c\u628a\u6570\u636e\u62c6\u6210\u4e86\u8fd9\u79cd\u5730\u6b65\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-javascript"},"    {\n        db1: ['table1'],\n        db2: ['table2'],\n        db3: ['table3'],\n        db4: ['table4'],\n    }\n")),(0,n.kt)("p",null,"\u4e4b\u540e\u6211\u4eec\u53c8\u4f1a\u9047\u5230\u65b0\u7684\u95ee\u9898\uff1atable1 \u6491\u6ee1\u4e86\u3002\u3002\u73b0\u5728\u6211\u4eec\u9664\u4e86\u5347\u7ea7 db1 \u7684\u673a\u5668\uff0c\u518d\u6ca1\u6709\u522b\u7684\u529e\u6cd5\u6269\u5bb9\u4e86\u3002"),(0,n.kt)("h3",{id:"ntsdb"},"NTSDB"),(0,n.kt)("p",null,"NTSDB \u4e3a\u7f51\u6613\u6570\u636e\u79d1\u5b66\u4e2d\u5fc3\u57fa\u4e8e Influx \u81ea\u7814\u7684\u65f6\u5e8f\u6570\u636e\u5e93\u3002\u57fa\u672c\u67b6\u6784\u793a\u610f\u5982\u4e0b\uff1a\n",(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/249sryZCD3i2-6gdvlJtAQ==/109951163959223735.png",alt:"image"})),(0,n.kt)("p",null,"\u96c6\u7fa4\u62e5\u6709 3 \u53f0 master \u8282\u70b9, \u8d1f\u8d23\u63a5\u6536\u6570\u636e\u8bfb\u5199\u8bf7\u6c42\u3001\u540c\u6b65\u6570\u636e\u5e93\u7ba1\u7406\u914d\u7f6e\u5982\u521b\u5efa Petention Policy(\u6570\u636e\u4fdd\u7559\u8fc7\u671f\u7b56\u7565)\u3001\u521b\u5efa Continue Query(\u6301\u7eed\u67e5\u8be2), master \u8282\u70b9\u975e\u5e38\u8f7b\u91cf\u3002\u5b9e\u9645\u7684\u5b58\u50a8\u4e0e\u8ba1\u7b97\u4efb\u52a1\u7531 Shard Server \u8fdb\u884c\u3002"),(0,n.kt)("h4",{id:"influx-\u5b58\u50a8\u6a21\u578b\u7b80\u4ecb"},"Influx \u5b58\u50a8\u6a21\u578b\u7b80\u4ecb"),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/aMzLd3vJJGPydkRsUWQFYw==/109951163959253224.png",alt:"image"}),"\n\u5728\u4e00\u5f20 Influx \u6570\u636e\u5e93\u4e4b\u4e0a\u53ef\u4ee5\u521b\u5efa\u4efb\u610f\u591a\u4e2a Rentention Policy(\u6570\u636e\u4fdd\u7559\u7b56\u7565), \b \u4e00\u4e2a RP \u53ef\u4ee5",(0,n.kt)("a",{parentName:"p",href:"https://docs.influxdata.com/influxdb/v1.7/query_language/database_management/#create-retention-policies-with-create-retention-policy"},"\u914d\u7f6e"),"\u5982\u4e0b\u53c2\u6570\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"DURATION: \u6570\u636e\u8fc7\u671f\u65f6\u95f4, \u8fc7\u671f\u540e\u7684\u6570\u636e\u81ea\u52a8\u5220\u9664\u3002"),(0,n.kt)("li",{parentName:"ul"},"REPLICATION: \u526f\u672c\u6570 \b\u3002"),(0,n.kt)("li",{parentName:"ul"},"SHARD DURATION: shard group \u7684\u6301\u7eed\u65f6\u957f, \u6301\u7eed\u65f6\u95f4\u7ed3\u675f\u540e\u4f1a\u5f62\u6210\u65b0\u7684 ShardGroup."),(0,n.kt)("li",{parentName:"ul"},"SHARD BUCKET: \u6bcf\u4e2a Shard Group \u5305\u542b\u7684 Shard \u4e2a\u6570\u3002Influx DB \u5355\u673a\u7248\u672a\u63d0\u4f9b\u8be5\u53c2\u6570(\u9ed8\u8ba4\u4e3a 1)\u3001NTSDB \u63d0\u4f9b\u8be5\u914d\u7f6e\u3002")),(0,n.kt)("p",null,"\u4e3e\u4f8b\u6765\u8bf4\u5f53\u914d\u7f6e"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-shell"},'$CREATE RETENTION POLICY "rp_only_week" ON "wapm" >\nDURATION 7d >\nREPLICATION 2 >\nSHARD DURATION 1d  >\nSHARD BUCKET 3;\n')),(0,n.kt)("p",null,"\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u540d\u4e3a",(0,n.kt)("inlineCode",{parentName:"p"},"rp_only_week"),"\u7684 RP, \u5176\u6570\u636e\u6700\u957f\u4fdd\u7559 7 \u5929\uff0c\u526f\u672c\u6570\u4e3a 2 \u4e2a\uff0cShardGroup \u7684\u6301\u7eed\u65f6\u95f4\u4e3a 1 \u5929, \u6bcf\u4e2a ShardGroup \u542b\u6709 3 \u4e2a Shard\u3002"),(0,n.kt)("p",null,"\u5b58\u5165\u6570\u636e\u65f6\u662f\u53ef\u4ee5\u6307\u5b9a RP(\u672a\u6307\u5b9a\u65f6\u6709\u9ed8\u8ba4 RP), \u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u62a5\u7684\u539f\u59cb\u6570\u636e\u5b58\u5165 7 \u5929\u7684 RP \u5185, \u5c06\u805a\u5408\u8fc7\u540e\u7684\u6570\u636e\uff0c\u5b58\u5165\u4e00\u5e74\u8fc7\u671f\u7684 RP \u5185\u3002\u6570\u636e\u7684\u8fc7\u671f\uff0c\u4e0d\u662f\u5c06\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u95f4\u4e0e duration \u505a\u5bf9\u6bd4\uff0c\u800c\u662f\u5224\u65ad\u4e00\u4e2a ShardGroup \u5185\u7684\u6700\u65b0\u7684\u6570\u636e\u662f\u5426\u5df2\u7ecf\u8fc7\u671f\uff0c\u5982\u679c\u6700\u65b0\u4e00\u6761\u8bb0\u5f55\u90fd\u8fc7\u671f\u4e86\uff0c\u5219\u6574\u4e2a ShardGroup \u5185\u7684\u6570\u636e\u505a\u6279\u91cf\u5220\u9664\uff0c\u6548\u7387\u975e\u5e38\u9ad8\u3002"),(0,n.kt)("p",null,"\b \u5f53\u6709\u6570\u636e\u5b58\u5165\u65f6\uff0cinflux \u4f1a\u5c06\u6570\u636e\u7684 measurement + tagKey1 + tagValue1 + tagKey2 + tagValue2 +... \u5f62\u6210 SeriesKey, \u5e76\u5c06 SeriesKey \u505a hash \u8fd0\u7b97\u540e\u5b58\u5165\u67d0\u4e2a shard \u5185\u3002\u540c\u4e00\u4e2a ShardGroup \u5185 Shard \u4e2a\u6570\u8d8a\u591a\uff0c\u8bfb\u5199\u6027\u80fd\u8d8a\u9ad8\u3002\u53ef\u4ee5\u5c06 Shard \u7406\u89e3\u4e3a Influx \u5b9e\u9645\u505a\u5b58\u50a8\u4e0e\u8ba1\u7b97\u5f15\u64ce\u3002"),(0,n.kt)("p",null,"\b \u56de\u5934\u6765\u770b\u4e0b NTSDB \u7684\u67b6\u6784\uff1a\n",(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/249sryZCD3i2-6gdvlJtAQ==/109951163959223735.png",alt:"image"}),"\n\u4e00\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u53ef\u5206\u4e3a\u591a\u4e2a shard \u843d\u5230\u4e0d\u540c\u7684 ShardServer \u4e0a\uff0c\u6bcf\u4e2a shard \u90fd\u6709\u81ea\u5df1\u7684\u526f\u672c\uff0c\u5b58\u5230\u4e0d\u540c\u7684\u4e3b\u673a\u4e0a\uff0c\u4ee5\u4fdd\u8bc1\u9ad8\u53ef\u7528\u3002\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u6a2a\u5411\u65e0\u9650\u5730\u589e\u52a0 ShardServer \u7684\u4e2a\u6570\uff0c\u5f53\u4e00\u53f0 ShardServer \u65e0\u6cd5\u627f\u62c5\u4e00\u4e2a Shard \u7684\u538b\u529b\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574 SHARD BUCKET \u7684\u6570\u91cf\uff0c\u8ba9\u6570\u636e\u5747\u644a\u5230\u5176\u4ed6\u8282\u70b9\u3002\u800c\u8282\u70b9\u7684\u4fdd\u6d3b\u3001\u5907\u4efd\u3001Petention Policy(\u6570\u636e\u4fdd\u7559\u8fc7\u671f\u7b56\u7565)\u3001Continue Query(\u6301\u7eed\u67e5\u8be2)\u7684\u7ba1\u7406\u90fd\u53ef\u4ee5\u53ea\u8fde\u63a5\u5230\u4e00\u53f0 master \u4e0a\u8fdb\u884c\u7ba1\u7406\uff0cmaster \u8282\u70b9\u4f1a\u81ea\u52a8\u540c\u6b65\u7ed9\u5176\u4ed6\u8282\u70b9\u3002"),(0,n.kt)("p",null,"\u53ef\u4ee5\u8bf4 NTSDB \u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86\u6211\u4eec\u5f53\u524d\u5b58\u50a8\u67b6\u6784\u7684\u75db\u70b9\u3002"),(0,n.kt)("h3",{id:"\u6807\u51c6\u67b6\u6784"},"\u6807\u51c6\u67b6\u6784"),(0,n.kt)("p",null,"\u6211\u4eec\u5f53\u524d\u7684\u67b6\u6784\u53ef\u4ee5\u7b80\u5355\u62bd\u8c61\u4e3a\u5982\u4e0b\u6d41\u7a0b\uff1a\n",(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/FDMpSUh5Cb-oPSOydP5fbQ==/109951163959325299.png",alt:"image"}),"\n\b \u6211\u4eec\u5c06\u6240\u6709\u7684\u539f\u59cb\u6570\u636e\u5b58\u5165 Influx, \u5e76\u5728 Influx \u4e0a\u5efa\u7acb CQ \u505a\u9884\u805a\u5408\u8ba1\u7b97\uff0c\u4ee5\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\u3002"),(0,n.kt)("p",null,"\u5728\u6b64\u67b6\u6784\u4e4b\u4e0a\uff0c\u6211\u4eec\u8ba1\u5212\u518d\u8fdb\u4e00\u6b65\uff0c\u5f15\u8fdb\u4e1a\u754c\u66f4\u4e3a\u901a\u7528\u7684\u5b58\u50a8\u8ba1\u7b97\u67b6\u6784\uff1a\n",(0,n.kt)("img",{parentName:"p",src:"https://p1.music.126.net/SsF26FVK5sqc8xhWz1a4fw==/109951163959336654.png",alt:"image"})),(0,n.kt)("p",null,"\u6211\u4eec\u5f15\u5165 Kafka \u6765\u505a\u6d88\u606f\u961f\u5217\uff0c\u6709\u5982\u4e0b\u51e0\u70b9\u597d\u5904\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u539f\u672c Server \u76f4\u63a5\u5bf9 Influx, Influx \u82e5\u6302\u6389\uff0c\u5219\u8fd9\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u5c31\u4f1a\u5b8c\u5168\u4e22\u5931\u3002\u5f15\u5165\u6d88\u606f\u961f\u5217\u540e\uff0c\u6570\u636e\u53ef\u4ee5\u5148\u5165\u961f\uff0c\u540e\u6d88\u8d39\u3002"),(0,n.kt)("li",{parentName:"ul"},"\u53ef\u5e94\u5bf9\u9ad8\u5cf0\u6d41\u91cf\uff0c\u9ad8\u5cf0\u6d41\u91cf\u4e0d\u5e38\u6709\uff0c\u5982\u679c\u4e3a\u4e86\u9ad8\u5cf0\u6d41\u91cf\u800c\u4e00\u76f4\u9884\u5907\u7740\u9ad8\u914d\u673a\u5668\uff0c\u591a\u5c11\u4f1a\u662f\u4e00\u79cd\u6d6a\u8d39\uff0c\u800c\u5f15\u5165 kafka\uff0cinflux \u5c31\u4e0d\u9700\u8981\u6709\u5b8c\u5168\u5339\u914d\u9ad8\u5cf0\u6d41\u91cf\u7684\u914d\u7f6e\uff0c\u9ad8\u5cf0\u65f6\u53ef\u5728 kafka \u5148\u7f13\u5b58\uff0c\u5f85\u9ad8\u5cf0\u8fc7\u540e\uff0c\u9010\u6b65\u6d88\u8d39\u3002")),(0,n.kt)("p",null,"\u5f15\u5165 Flink \u505a\u805a\u5408\u8ba1\u7b97\uff0c\u6709\u5982\u4e0b\u51e0\u70b9\u597d\u5904\uff1a"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"\u66f4\u4e13\u4e1a, \u5927\u6570\u636e\u5206\u5e03\u5f0f\u8ba1\u7b97\u5e73\u53f0\uff0c\u63d0\u4f9b\u66f4\u591a\u7684\u805a\u5408\u51fd\u6570\uff0c\u901a\u8fc7\u5199 SQL \u5c31\u53ef\u4ee5\u5b8c\u6210\u805a\u5408\u4efb\u52a1\u914d\u7f6e\u3002"),(0,n.kt)("li",{parentName:"ul"},"\u66f4\u7075\u6d3b, \u672a\u63d0\u4f9b\u7684\u805a\u5408\u51fd\u6570\uff0c\u53ef\u901a\u8fc7\u5f00\u53d1 JAR \u5305\u7684\u65b9\u5f0f\uff0c\u7075\u6d3b\u81ea\u5b9a\u4e49\u914d\u7f6e\u3002")),(0,n.kt)("p",null,"\u7f51\u6613\u4e91\u97f3\u4e50\u57fa\u4e8e Flink \u81ea\u7814\u7684",(0,n.kt)("a",{parentName:"p",href:"https://music-rtfm.hz.NetEase.com/magina-doc/"},"Magina \u5e73\u53f0"),"\u53ef\u7b80\u5316 Flink \u7684\u4f7f\u7528\uff0c\u8ba9\u5927\u6570\u636e\u8ba1\u7b97\u66f4\u52a0\u4eb2\u6c11\u3002"),(0,n.kt)("p",null,"\u6587\u672b\u518d\u6b21\u611f\u8c22\u7f51\u6613\u6570\u636e\u79d1\u5b66\u4e2d\u5fc3-\u65f6\u5e8f\u6570\u636e\u5e93\u9886\u57df\u4e13\u5bb6-",(0,n.kt)("a",{href:"http://hbasefly.com/author/libisthanksgmail-com/",target:"_blank"},"\u8303\u6b23\u6b23"),"\uff0c\u5bf9\u4e91\u97f3\u4e50\u524d\u7aef\u6027\u80fd\u76d1\u63a7\u5e73\u53f0\u7684\u67b6\u6784\u6539\u8fdb\u63d0\u51fa\u7684\u5b9d\u8d35\u5efa\u8bae\u3002"),(0,n.kt)("h3",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://docs.influxdata.com/influxdb/v1.7/query_language/database_management/#create-retention-policies-with-create-retention-policy"},"Influx Db \u6587\u6863")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://gitbook.cn/books/59428f6f7e850f039399fd02/index.html"},"\u5218\u5e73\uff1a\u997f\u4e86\u4e48 Influxdb \u5b9e\u6218\u89e3\u6790")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://hbasefly.com/2017/12/08/influxdb-1/"},"\u8303\u6b23\u6b23-\u65f6\u5e8f\u6570\u636e\u5e93\u6280\u672f\u4f53\u7cfb - \u521d\u8bc6 InfluxDB")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://hbasefly.com/2018/01/13/timeseries-database-4/"},"\u8303\u6b23\u6b23-\u65f6\u5e8f\u6570\u636e\u5e93\u6280\u672f\u4f53\u7cfb - InfluxDB TSM \u5b58\u50a8\u5f15\u64ce\u4e4b TSMFile")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://hbasefly.com/2018/02/09/timeseries-database-5/"},"\u8303\u6b23\u6b23-\u65f6\u5e8f\u6570\u636e\u5e93\u6280\u672f\u4f53\u7cfb - InfluxDB \u591a\u7ef4\u67e5\u8be2\u4e4b\u5012\u6392\u7d22\u5f15")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"http://kms.NetEase.com/#/article/5933"},"\u8303\u6b23\u6b23-\u7f51\u6613\u65f6\u5e8f\u6570\u636e\u5e93\uff0c\u4e30\u5bcc\u4f60\u7684\u6280\u672f\u6808"))))}d.isMDXComponent=!0}}]);